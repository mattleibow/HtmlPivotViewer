var Pivot;!function(t){var e="http://schemas.microsoft.com/livelabs/pivot/collection/2009",a=function(){function a(){}return a.load=function(e,a){var i=this;e&&a&&$.ajax({type:"GET",url:a,dataType:"xml",success:function(r){i.loadXml(e,r,a)||t.Logger.logError("Failed to parse CXML: "+a)},error:function(){t.Logger.logError("Failed to fetch CXML: "+a)}})},a.loadXml=function(i,r,n){if(!r)return!1;var o={},s=r.documentElement,l={},u=s.ELEMENT_NODE||1,c=s.getAttributeNS(e,"Supplement");c&&a.load(i,n.split("/").slice(0,-1).join("/")+"/"+c);var d=s.getAttribute("Name");d&&i.setTitle(d);var p=s.getElementsByTagName("FacetCategories")[0];if(p){for(var v=0;v<p.childNodes.length;v++){var f=p.childNodes[v];if(f.nodeType===u){var h=new t.Facet(f.getAttribute("Name"));h.index=v,h.type=f.getAttribute("Type");var g=f.getAttributeNS(e,"IsFilterVisible"),m=f.getAttributeNS(e,"IsMetaDataVisible"),b=f.getAttributeNS(e,"IsWordWheelVisible");h.isFilterVisible=null==g||""==g.trim()||"true"===g,h.isMetaDataVisible=null==m||""==m.trim()||"true"===m,h.isWordWheelVisible=!(null!=b&&""!=b.trim()&&"true"!==b||h.type!==t.FacetTypes.String&&h.type!==t.FacetTypes.LongString&&h.type!==t.FacetTypes.Link),l[h.name]=h;for(var y=f.childNodes,T=0;T<y.length;T++){var C=y[T].firstChild;if(C&&"SortOrder"===C.localName&&C.namespaceURI===e){var _={name:C.getAttribute("Name"),order:[]};h.orders.push(_);for(var k=C.childNodes,w=0;w<k.length;w++){var F=k[w];"SortValue"===F.localName&&F.namespaceURI===e&&_.order.push(F.getAttribute("Value"))}}}}}i.setFacets(l)}for(var L=s.childNodes,v=L.length-1;v>=0;v--){var x=L[v];if("Extension"===x.tagName){var C=x.firstChild;C&&"Copyright"===C.localName&&C.namespaceURI===e&&i.setCopyright({href:n.split("/").slice(0,-1).join("/")+"/"+C.getAttribute("Href"),name:C.getAttribute("Name")})}}var B=s.getElementsByTagName("Items")[0];if(!B)return!1;var $=B.getAttribute("ImgBase");$&&(o=n.slice(0,n.lastIndexOf("/")+1)+$.replace("\\","/"));for(var S=[],P=B.childNodes,v=0;v<P.length;v++){var D=P[v];if(D.nodeType===u){var I=D.getAttribute("Id"),N=i.getItemById(I)||new t.Item(I);S.push(N);var V=D.getAttribute("Href");V&&(N.href=V);var H=D.getAttribute("Name");H&&(N.name=H);var M=D.getAttribute("Img");M&&(N.img=o+M);var E=D.getElementsByTagName("Description");E.length&&(N.description=E[0].textContent);var A=D.getElementsByTagName("Facets")[0];if(A)for(var O=A.childNodes,T=0;T<O.length;T++){var f=O[T];if(f.nodeType===u)for(var W=f.getAttribute("Name"),h=l[W],U=N.facets[W]=[],z=f.childNodes,w=0;w<z.length;w++){var R=z[w];if(R.nodeType===u){var Y=void 0;switch(h.type){case t.FacetTypes.String:case t.FacetTypes.LongString:Y={value:R.getAttribute("Value").trim()};break;case t.FacetTypes.Link:Y={href:R.getAttribute("Href"),value:R.getAttribute("Name").trim()};break;case t.FacetTypes.Number:Y={value:parseFloat(R.getAttribute("Value").trim())};break;case t.FacetTypes.DateTime:Y={value:new Date(R.getAttribute("Value").trim())};break;default:Y={value:R.getAttribute("Value").trim()},t.Logger.logWarning("Unknown facet type "+h.type)}U.push(Y)}}}}}return S.length&&i.addItems(S),!0},a}();t.CxmlLoader=a}(Pivot||(Pivot={}));var Pivot;!function(t){var e=function(){function e(t,e,i,r){var n=this;this.facetName=i,this.currentFilterValues=r||[],t=$(t);var o=null,s=null;if(e.forEach(function(t){var e=t.facets[i];e&&e.forEach(function(t){(null==s||t.value>s)&&(s=t.value),(null==o||t.value<o)&&(o=t.value)})}),null==o)$("<div>").text("Not Currently Applicable").addClass("pivot_numberlabel").appendTo(t);else{var l=a.chooseDateScale(o,s),u=a.generateBuckets(o,s,l),c=a.generateBuckets(o,s,l-1),d=u.concat(c);d.forEach(function(t){t.count=0,t.items=[]}),e.forEach(function(t){var e=t.facets[i];e&&e.forEach(function(t){d.forEach(function(e){t.value>=e.lowerBound&&t.value<e.upperBound&&e.count++})})}),this.list=$("<ul>").addClass("pivot").appendTo(t).append($("<li>").addClass("pivot_horizbar")),u.forEach(function(t){return n.makeBucketUI(t)}),c.forEach(function(t){return n.makeBucketUI(t)})}}return e.prototype.onFacetValueCheckboxClicked=function(t){var e=$(t.target);e.prop("checked")?(this.currentFilterValues.push(e.data("filterInfo")),this.trigger("filter",[this.facetName,this.currentFilterValues])):(this.currentFilterValues.splice(this.currentFilterValues.indexOf(e.data("filterInfo")),1),this.trigger("filter",[this.facetName,this.currentFilterValues.length?this.currentFilterValues:void 0]))},e.prototype.onFacetValueNameClicked=function(t){var e=$(t.target).data("filterInfo");this.currentFilterValues.forEach(function(t){t.checkbox.prop("checked",!1)}),e.checkbox.prop("checked",!0),this.currentFilterValues=[e],this.trigger("filter",[this.facetName,this.currentFilterValues])},e.prototype.makeBucketUI=function(t){var e=this,a=$("<li>").attr("title",t.label).appendTo(this.list),i=$("<input>").attr("type","checkbox").addClass("pivot pivot_facetcheckbox").data("filterInfo",t).appendTo(a).click(function(t){return e.onFacetValueCheckboxClicked(t)});if(this.currentFilterValues){var r=this.currentFilterValues.some(function(a,i){return a.lowerBound.getTime()===t.lowerBound.getTime()&&a.upperBound.getTime()===t.upperBound.getTime()?(e.currentFilterValues[i]=t,!0):!1});r&&i.prop("checked",!0)}t.checkbox=i;var n=$("<div>").addClass("pivot_outerlabel").data("filterInfo",t).appendTo(a).click(function(t){return e.onFacetValueNameClicked(t)});$("<div>").addClass("pivot_facetcount").text(t.count).data("filterInfo",t).appendTo(n),$("<div>").addClass("pivot_facetlabel").text(t.label).data("filterInfo",t).appendTo(n)},e.prototype.addListener=function(e,a){t.Helpers.addListener(this,e,a)},e.prototype.trigger=function(e,a){t.Helpers.trigger(this,e,a)},e}();t.PivotDatePicker=e;var a=function(){function t(){}return t.getHalfMonth=function(t){return 1===t?15:16},t.chooseDateScale=function(e,a){var i=a.getFullYear()-e.getFullYear();if(i)return Math.floor(Math.log(i)/Math.LN10);var r=a.getMonth();if(r>e.getMonth())return-1;var n=a.getDate(),o=e.getDate(),s=t.getHalfMonth(r);return s>o&&n>=s?-2:n>o?-3:(i=a.getHours()-e.getHours(),i>=12?-4:i?-5:(i=a.getMinutes()-e.getMinutes(),i>=15?-6:i?-7:(i=a.getSeconds()-e.getSeconds(),i>=5?-8:-9)))},t.generateBuckets=function(e,a,i){if(!(a>=e)||-9>i)return[];null==i&&(i=t.chooseDateScale(e,a)),i>=0&&(i=Math.pow(10,i));var r=e.getFullYear(),n=0,o=1,s=0,l=0,u=0,c=0;if(i>=0)r=Math.floor(r/i)*i;else{if(i>=-9?u=e.getSeconds():i>=-8&&(u=5*Math.floor(e.getSeconds()/5)),i>=-7?l=e.getMinutes():i>=-6&&(l=15*Math.floor(e.getMinutes()/15)),i>=-5?s=e.getHours():i>=-4&&(s=12*Math.floor(e.getHours()/12)),i>=-3)o=e.getDate();else if(i>=-2){var d=t.getHalfMonth(n);o=e.getDate()>=d?d:1}i>=-1&&(n=e.getMonth())}e=new Date(r,n,o,s,l,u,c);var p;switch(i){case-9:p=function(t){return new Date(r,n,o,s,l,u+t,0)};break;case-8:p=function(t){return new Date(r,n,o,s,l,u+5*t,0)};break;case-7:p=function(t){return new Date(r,n,o,s,l+t,0,0)};break;case-6:p=function(t){return new Date(r,n,o,s,l+15*t,0,0)};break;case-5:p=function(t){return new Date(r,n,o,s+t,0,0,0)};break;case-4:p=function(t){return new Date(r,n,o,s+12*t,0,0,0)};break;case-3:p=function(t){return new Date(r,n,o+t,0,0,0,0)};break;case-2:p=function(e){o>1&&e++;var a=new Date(r,n+Math.floor(e/2),1,0,0,0,0);return e%2&&a.setDate(t.getHalfMonth(a.getMonth())),a};break;case-1:p=function(t){return new Date(r,n+t,1,0,0,0,0)};break;default:p=function(t){return new Date(r+t*i,0,1,0,0,0,0)}}var v,f=t.getLabelFunction(i),h=[],g=0,m=e;do{g++;var b=m;m=p(g);var y={lowerBound:b,upperBound:m};v=f(y,v),h.push(y)}while(a>=m);return h},t.getLabelFunction=function(e){switch(e){case-9:case-8:case-7:case-6:case-5:case-4:return function(e,a){var i,r=e.lowerBound.getDate();a===r?i=e.lowerBound.toLocaleTimeString():(i=e.lowerBound.toLocaleDateString()+" "+e.lowerBound.toLocaleTimeString(),a=r);var n;return n=a===e.upperBound.getDate()?e.upperBound.toLocaleTimeString():e.upperBound.toLocaleDateString()+" "+e.upperBound.toLocaleTimeString(),t.setLabels(e,i,n),a};case-3:return function(e,a){return t.setLabels(e,e.lowerBound.toLocaleDateString()),a};case-2:return function(e,a){return t.setLabels(e,e.lowerBound.toLocaleDateString(),e.upperBound.toLocaleDateString()),a};case-1:return function(e,a){var i=e.lowerBound.getFullYear(),r=t.months[e.lowerBound.getMonth()];return a!==i&&(a=i,r+=" "+i),t.setLabels(e,r),a};default:return 1==e?function(e,a){return t.setLabels(e,e.lowerBound.getFullYear().toString()),a}:function(a,i){return t.setLabels(a,Math.floor(a.lowerBound.getFullYear()/e)*e+"s"),i}}},t.setLabels=function(t,e,a){a?(t.label=e+" to "+a,t.leftLabel=e,t.rightLabel=a):t.label=e},t.months=["January","February","March","April","May","June","July","August","September","October","November","December"],t}()}(Pivot||(Pivot={}));var Pivot;!function(t){var e=function(){function t(){this.blendTime=500,this.fadeTime=500,this.manualUpdates=!1,this.clipParent=null,this.immediateMode=!0,this.blur=0,this.src=null}return t}();t.DeepZoomImageOptions=e;var a=function(){function t(){}return t}();t.DeepZoomImage=a;var i=0;"undefined"!=typeof devicePixelRatio&&(i=Math.log(devicePixelRatio)/Math.LN2)}(Pivot||(Pivot={}));var Pivot;!function(t){var e=function(){function t(){}return t.isCanvasSupported=function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},t.hasOwnProperty=function(e,a){return t.hasOwnPropertyFunction.call(e,a)},t.formatNumber=function(e){if(!e)return"0";for(var a=Math.floor(Math.log(Math.abs(e))/Math.LN10),i=e/Math.pow(10,a),r=0;10>r&&Math.abs(i)>t.epsilon;)r++,i=10*(i-Math.round(i));return a>=r&&r+5>a?e.toFixed(0):e.toPrecision(r)},t.getFacetString=function(e){var a=e.value;return"number"==typeof a?a=t.formatNumber(a):a instanceof Date&&(a=a.toLocaleDateString()+" "+a.toLocaleTimeString()),a},t.addListener=function(t,e,a){$(t).on(e,a)},t.trigger=function(t,e,a){$(t).trigger(e,a),console.debug("send event: '"+e+"'")},t.hasOwnPropertyFunction={}.hasOwnProperty,t.epsilon=1e-5,t}();t.Helpers=e}(Pivot||(Pivot={}));var Pivot;!function(t){var e=function(){function t(){}return t.logError=function(t){console.error(t)},t.logWarning=function(t){console.warn(t)},t}();t.Logger=e}(Pivot||(Pivot={}));var Pivot;!function(t){var e=function(){function e(t,e,a,i,r,n){var o=this;this.container=$(t),this.leftLabel=r,this.rightLabel=n,a>e||(e=0,a=1),this.min=e,this.max=a,"number"!=typeof i?this.value=this.min+(this.max-this.min)/2:this.value=i,this.stepSize=(this.max-this.min)/16,this.minusButton=$("<div>").html("&minus;").attr("title",this.leftLabel).addClass("pivot_zoomout pivot_hoverable").appendTo(this.container),this.plusButton=$("<div>").text("+").attr("title",this.rightLabel).addClass("pivot_zoomin pivot_hoverable").appendTo(this.container),this.sliderBackground=$("<div>").addClass("pivot_zoomline").appendTo(this.container),this.sliderHandle=$("<div>").addClass("pivot_zoomhandle").appendTo(this.sliderBackground),this.pixelUnits=(this.max-this.min)/(this.sliderBackground.outerWidth()-this.sliderHandle.outerWidth()),this.minusButton.click(function(){o.minusButton.hasClass("pivot_disabled")||o.setValue(o.value-o.stepSize,!0)}),this.plusButton.click(function(){o.plusButton.hasClass("pivot_disabled")||o.setValue(o.value+o.stepSize,!0)}),this.dragTracker=new Draggabilly(this.sliderHandle[0],{axis:"x",containment:this.sliderBackground[0]}),this.dragTracker.on("dragMove",function(){o.setValue(o.dragTracker.position.x*o.pixelUnits+o.min,!0)}),this.container.click(function(t){var e=t.target;if(e===o.container[0]||e===o.sliderBackground[0]){var a=t.offsetX;e===o.container[0]&&(a-=o.sliderBackground.position().left),a>=0&&a<o.sliderBackground.outerWidth()&&o.setValue((a-o.sliderHandle.outerWidth()/2)*o.pixelUnits+o.min,!0)}}),this.setValue(i)}return e.prototype.setValue=function(e,a){var i=this.value;this.value=e,this.value<=this.min?(this.value=this.min,this.minusButton.hasClass("pivot_disabled")||(this.minusButton.attr("title",""),this.minusButton.addClass("pivot_disabled"))):this.minusButton.hasClass("pivot_disabled")&&(this.minusButton.attr("title",this.leftLabel),this.minusButton.removeClass("pivot_disabled")),this.value>=this.max?(this.value=this.max,this.plusButton.hasClass("pivot_disabled")||(this.plusButton.attr("title",""),this.plusButton.addClass("pivot_disabled"))):this.plusButton.hasClass("pivot_disabled")&&(this.plusButton.attr("title",this.rightLabel),this.plusButton.removeClass("pivot_disabled")),this.dragTracker.isDragging||(this.pxPosition=Math.round((this.value-this.min)/this.pixelUnits),this.sliderHandle.css("left",this.pxPosition+"px")),a&&i!==this.value&&t.Helpers.trigger(this,"change",[this.value])},e.prototype.addListener=function(e,a){t.Helpers.addListener(this,e,a)},e}();t.PivotSlider=e}(Pivot||(Pivot={}));var Pivot;!function(t){var e=function(){function e(t,e,a,i,r,n,o){this.items=[],this.filters=[],this.allItemsById={},this.activeItemsArr=[],this.rearrangingItemsArr=[],this.detailsEnabled=!0,this.nextId=0}return e.prototype.setTitle=function(t){this.trigger("titleChange",[t])},e.prototype.setFacets=function(e){if(this.items.length)throw"You must set facet categories before adding items.";this.filters=[],this.facets=e;var a=function(e){if(t.Helpers.hasOwnProperty(i.facets,e)){var a=i.facets[e],r=a.orders;r&&r.length&&!function(){var e={};r[0].order.forEach(function(t,a){e[t]=a}),a.comparator=function(a,i){var r=t.Helpers.hasOwnProperty(e,a),n=t.Helpers.hasOwnProperty(e,i);return r?n?e[a]-e[i]:-1:n?1:a===i?0:a>i?1:-1}}()}},i=this;for(var r in this.facets)a(r);this.trigger("hideDetails"),this.trigger("hideInfoButton"),this.trigger("facetsSet",[this.facets])},e.prototype.setCopyright=function(t){this.trigger("copyright",[t])},e.prototype.getItemById=function(t){return this.allItemsById[t]},e.prototype.addItems=function(e){var a=this;if(!this.items.length&&(this.activeItemsArr.length||this.rearrangingItemsArr.length))return void this.delayFunction(function(){a.addItems(e)});var i=1,r=[],n=function(){i--,i||(a.items=a.items.concat(r),e.forEach(a.updateTemplate),a.filter())};e.forEach(function(e){var i=e.id;i||"number"==typeof i||(i=e.id=a.generateId()),e.name||(e.name=""),e.description||(e.description=""),e.href||(e.href=""),e.facets||(e.facets={}),t.Helpers.hasOwnProperty(a.allItemsById,i)||(a.allItemsById[i]=e,r.push(e)),a.centerItem===e&&a.zoomedIn&&a.detailsEnabled&&(a.trigger("hideDetails"),a.trigger("showDetails",[e,a.facets]))}),n()},e.prototype.moveLeft=function(){},e.prototype.moveRight=function(){},e.prototype.collapseDetails=function(){},e.prototype.expandDetails=function(){},e.prototype.sortBy=function(t){},e.prototype.zoomToPercent=function(t){},e.prototype.graphView=function(){return!0},e.prototype.gridView=function(){return!0},e.prototype.runSearch=function(e){var a=[];if(e){var i={},r={};e=e.toLowerCase();var n=function(a){var n=t.Helpers.getFacetString(a),o=n.toLowerCase().indexOf(e),s=null;0===o?s=i:o>0&&(s=r),s&&(t.Helpers.hasOwnProperty(s,n)?s[n]++:s[n]=1)};this.items.forEach(function(e){var a=e.facets;for(var i in a)t.Helpers.hasOwnProperty(a,i)&&a[i].forEach(n);n({value:e.name})});for(var o=0,s=[i,r];o<s.length;o++){var l=s[o],u=[];for(var c in l)t.Helpers.hasOwnProperty(l,c)&&u.push({value:c,count:l[c]});u.sort(function(t,e){return e.count-t.count});for(var d=0,p=u;d<p.length;d++){var v=p[d];a.push(v.value)}}}return a},e.prototype.addListener=function(e,a){t.Helpers.addListener(this,e,a)},e.prototype.trigger=function(e,a){t.Helpers.trigger(this,e,a)},e.prototype.delayFunction=function(t,e){var a=this;if(!e||0>e)if(this.delayedFunction){var i=this.delayedFunction;this.delayedFunction=function(){i(),t()}}else this.delayedFunction=t;else this.delayedFunction(function(){a.delayedFunction(t,e-1)})},e.prototype.rearrange=function(){},e.prototype.generateId=function(){var e=0;do e=this.nextId++;while(t.Helpers.hasOwnProperty(this.allItemsById,e.toString()));return e.toString()},e.prototype.filter=function(){this.rearrange()},e.prototype.addFilter=function(t){"function"==typeof t&&this.filters.push(t)},e.prototype.removeFilter=function(t){var e=this.filters.indexOf(t);-1!==e&&this.filters.splice(e,1)},e.prototype.clearFilters=function(){this.filters=[]},e.prototype.updateTemplate=function(t){},e.prototype.runFiltersWithout=function(t){var e=this;this.removeFilter(t);var a=this.items.filter(function(t){return e.filters.every(function(e){return e(t)})});return this.addFilter(t),a},e}();t.PivotViewer=e}(Pivot||(Pivot={}));var Pivot;!function(t){var e=function(){function e(){}return e.init=function(e,a){function i(){Z?(J.removeClass("pivot_clrsearch"),mt()):(X.removeClass("pivot_watermark"),N.val("")),J[0].onmousedown=ft}var r=$(e);if(r.empty(),!t.Helpers.isCanvasSupported())return t.Logger.logError("Your browser doesn't support canvas! Get a better one."),null;var n=$("<input>").attr("type","checkbox").addClass("pivot_input").appendTo(r),o=$("<div>").addClass("pivot pivot_viewbox").appendTo(r),s=$("<div>").addClass("pivot pivot_topbar").appendTo(o),l=$("<div>").addClass("pivot pivot_title").appendTo(s),u=$("<div>").addClass("pivot pivot_canvas").appendTo(o),c=$("<div>").addClass("pivot pivot_layer").appendTo(u),d=$("<div>").addClass("pivot pivot_layer").appendTo(c),p=$("<canvas>").addClass("pivot").appendTo(c),v=$("<div>").addClass("pivot pivot_layer").appendTo(c),f=$("<div>").addClass("pivot pivot_pane pivot_filterpane").appendTo(u),h=f.position().left+f.outerWidth(),g=new t.PivotViewer(p,c,v,d,h,h,n),m=$("<div>").addClass("pivot pivot_pane pivot_detailspane pivot_hidden").hide().css("opacity",0).appendTo(u);$("<div>").addClass("pivot_hoverable pivot_left pivot_larr").appendTo(m).click(function(){g.moveLeft()}),$("<div>").addClass("pivot_left pivot_subtle pivot_vertbar").text("|").appendTo(m),$("<div>").addClass("pivot_hoverable pivot_left pivot_rarr").appendTo(m).click(function(){g.moveRight()}),$("<div>").addClass("pivot_hoverable pivot_right pivot_collapse").appendTo(m).click(function(){g.collapseDetails()});var b=$("<a>").attr("target","_blank").addClass("pivot").appendTo($("<h2>").addClass("pivot").appendTo(m)),y=$("<div>").addClass("pivot pivot_scrollable").appendTo(m),T=$("<div>").addClass("pivot pivot_description").appendTo(y),C=$("<div>").addClass("pivot_sortlabel").appendTo(y),_=$("<dl>").addClass("pivot").appendTo(y),k=$("<div>").addClass("pivot_copyright").appendTo(m),w=$("<div>").addClass("pivot_info pivot_hidden").hide().css("opacity",0).appendTo(u).click(function(){g.expandDetails()});C.click(function(){T.hasClass("pivot_collapsed")?(T.removeClass("pivot_collapsed"),C.text("less")):(T.addClass("pivot_collapsed"),C.text("more"))});var F=null,L=null;g.addListener("showDetails",function(e,a,i){if(m.hasClass("pivot_hidden")&&(m.removeClass("pivot_hidden"),null!==L&&(clearTimeout(L),L=null),m.show(),setTimeout(function(){m.css("opacity",1)}),f.addClass("pivot_faded")),a!==F){b.text(a.name||""),b.attr("href",a.href||""),y.height(k.position().top-y.position().top),T.text(a.description||""),T.outerHeight()>80?(C.click(),C.show()):C.hide(),_.empty();var r=a.facets,n=[];for(var o in r){var s=i[o];t.Helpers.hasOwnProperty(r,o)&&s&&s.isMetaDataVisible&&n.push(o)}n.sort(function(t,e){return(i[t].index||0)-(i[e].index||0)});for(var l=function(e){var a=n[e],o=i[a];$("<dt>").addClass("pivot").text(a).appendTo(_);for(var s=$("<dd>").addClass("pivot").appendTo(_),l=r[a],u=function(e){var i=$("<div>").appendTo(s),r=l[e],n=null,u=t.Helpers.getFacetString(r);switch(o.type){case t.FacetTypes.String:case t.FacetTypes.LongString:i.text(u),n={value:u};break;case t.FacetTypes.Link:var c=r.href;$("<a>").attr("target","_blank").attr("href",c).text(u).appendTo(i),n={value:u};break;case t.FacetTypes.Number:var d=r.value;i.text(u),n={inclusive:!0,upperBound:d,lowerBound:d};break;case t.FacetTypes.DateTime:var p=r;i.text(u),n={lowerBound:p.value,upperBound:new Date(p.value.getTime()+1e3)};break;default:t.Logger.logWarning("Unrecognized facet type in details pane: "+o.type)}null!==n&&o.isFilterVisible&&(i.addClass("pivot_filterable"),function(){var t=a,e=[n],r=o.type;i.click(function(){vt(!0),Q(t,e,r),lt(),g.filter()})}())},c=0;c<l.length;c++)u(c)},u=0;u<n.length;++u)l(u);F=a}}),g.addListener("hideDetails",function(){m.hasClass("pivot_hidden")||(m.addClass("pivot_hidden"),m.css("opacity",0),L=setTimeout(function(){m.hide(),L=null},500),F=null,f.removeClass("pivot_faded"))});var x=null;g.addListener("showInfoButton",function(){w.hasClass("pivot_hidden")&&(w.removeClass("pivot_hidden"),w.show(),setTimeout(function(){w.css("opacity",1)},0),f.addClass("pivot_faded"),null!==x&&(clearTimeout(x),x=null))}),g.addListener("hideInfoButton",function(){w.hasClass("pivot_hidden")||(w.addClass("pivot_hidden"),w.css("opacity",0),x=setTimeout(function(){w.hide(),x=null},500),f.removeClass("pivot_faded"))});var B=$("<div>").addClass("pivot pivot_sorttools pivot_zoomslider").appendTo(s),S=new t.PivotSlider(B,0,100,0,"Zoom Out","Zoom In");g.addListener("zoom",function(t,e){S.setValue(e)}),S.addListener("change",function(t,e){g.zoomToPercent(e)});var P=$("<div>").attr("title","Graph View").addClass("pivot_sorttools pivot_graph pivot_hoverable").appendTo(s),D=$("<div>").attr("title","Grid View").addClass("pivot_sorttools pivot_grid pivot_activesort").appendTo(s);P.click(function(){g.graphView()&&(P.removeClass("pivot_hoverable").addClass("pivot_activesort"),D.removeClass("pivot_activesort").addClass("pivot_hoverable"))}),D.click(function(){g.gridView()&&(D.removeClass("pivot_hoverable").addClass("pivot_activesort"),P.removeClass("pivot_activesort").addClass("pivot_hoverable"))});var I=$("<select>").addClass("pivot pivot_sorttools").appendTo(s);I.change(function(){g.sortBy(I.val())}),$("<div>").text("Sort:").addClass("pivot_sorttools pivot_subtle").appendTo(s),g.addListener("titleChange",function(t,e){l.text(e)}),g.addListener("copyright",function(t,e){k.html(""),$("<a>").attr("href",e.href).attr("target","_blank").text(e.name).appendTo(k)});var N,V,H,M,E,A,O,W,U,z,R,Y,X,Z,G,J,j,q,Q=function(e,a,i){var r=M[e];if(a&&a.length>0)if(r)r.values=a;else{var n=void 0;switch(i){case t.FacetTypes.String:case t.FacetTypes.LongString:case t.FacetTypes.Link:n=function(t){return r.values.some(function(a){var i=t.facets[e];return i?i.some(function(t){return a.value===t.value}):"(no info)"===a.value})};break;case t.FacetTypes.DateTime:case t.FacetTypes.Number:n=function(t){return r.values.some(function(a){var i=t.facets[e];return i?i.some(function(t){return t.value>=a.lowerBound&&(a.inclusive?t.value<=a.upperBound:t.value<a.upperBound)}):null==a.lowerBound})};break;default:return void t.Logger.logWarning("Unrecognized facet type "+i)}r=M[e]={filter:n,values:a},g.addFilter(r.filter),O++;var o=Y[e];o&&o.css("visibility","visible"),1===O&&R.css("visibility","visible")}else{r&&(delete M[e],g.removeFilter(r.filter),O--);var o=Y[e];o&&o.css("visibility",""),O||Z||R.css("visibility","")}},K=function(t){var e=M[E],a=E,i=$(t.target);if(i.prop("checked")){var r={value:i.attr("name")};e?e.values.push(r):Q(a,[r],q)}else{for(var n=-1,o=0;o<e.values.length;o++)if(e.values[o].value==i.attr("name")){n=o;break}-1!==n&&e.values.splice(n,1),e.values.length||Q(E)}g.filter()},tt=function(t){var e=M[E],a=$(t.target).parent().prev();a.prop("checked",!0);var i=a.attr("name");e?(V.children().last().children().each(function(t,e){var a=$(e).children().first();a.attr("name")!==i&&a.prop("checked",!1)}),e.values=[{value:i}],g.filter()):K({target:a[0]})},et=function(t,e,a,i){var r={lowerBound:e,upperBound:a,inclusive:i};Q(t,[r],"Number"),g.filter()},at=function(t){Q(t),g.filter()},it=function(t,e){Q(t,e,"DateTime"),g.filter()},rt=function(t,e){return e.count-t.count},nt=function(t,e){var a=t.value,i=e.value;return a===i?0:"(no info)"===a?1:"(no info)"===i?-1:a>i?1:-1},ot=function(){H.data("currentComparator",(H.data("currentComparator")+1)%H.data("comparators").length),lt()},st=function(e){V&&V.css({height:0,overflow:"hidden"});var a=$(e.target);a.attr("name")||(a=a.parent()),H=a,E=a.attr("name"),q=a.data("facetType");var i=a.next();i.html("");var r=M[E]||{},n=g.runFiltersWithout(r.filter);switch(q){case t.FacetTypes.Link:case t.FacetTypes.String:case t.FacetTypes.LongString:var o={},s=function(e){var a=t.Helpers.getFacetString(e);o[a]||(o[a]=0),o[a]++};n.forEach(function(t){t.facets[E]?t.facets[E].forEach(s):s({value:"(no info)"})});var l=[];for(var u in o)t.Helpers.hasOwnProperty(o,u)&&l.push({value:u,count:o[u]});l.sort(a.data("comparators")[a.data("currentComparator")]),$("<div>").text(a.data("comparatorNames")[a.data("currentComparator")]).addClass("pivot_sortlabel").appendTo(i).click(function(){return ot()});var c=$("<ul>").addClass("pivot").appendTo(i),d=r.values||[];l.forEach(function(t){var e=t.value,a=$("<li>").appendTo(c);$("<input>").attr("type","checkbox").attr("name",e).addClass("pivot pivot_facetcheckbox").prop("checked",d.some(function(e){return e.value===t.value})).appendTo(a).click(function(t){return K(t)});var i=$("<div>").addClass("pivot_outerlabel").appendTo(a).click(function(t){return tt(t)});$("<div>").addClass("pivot_facetcount").text(t.count).appendTo(i),$("<div>").addClass("pivot_facetlabel").attr("title",e).text(e).appendTo(i)});break;case t.FacetTypes.Number:et=et,at=at;break;case t.FacetTypes.DateTime:var p=new t.PivotDatePicker(i,n,E,r.values);p.addListener("filter",function(t,e,a){return it(e,a)});break;default:t.Logger.logWarning("Unrecognized facet type: "+q)}i.css({height:Math.max(150,f.height()+z)+"px",overflowY:"auto"}),V=i},lt=function(){V&&st({target:V.prev()[0]})};g.addListener("resize",lt);var ut=function(t){},ct=function(e){var a=e.facets,i=Z.trim().toLowerCase().split(" ");return i.every(function(i){return-1!==e.name.toLowerCase().indexOf(i)||A.some(function(e){var r=a[e];return r&&r.some(function(e){return-1!==t.Helpers.getFacetString(e).toLowerCase().indexOf(i)})})})},dt=function(){Z?(N.val(Z),J.addClass("pivot_clrsearch"),J[0].onmousedown=function(){return pt()}):(X.addClass("pivot_watermark"),N.val("Search..."),J[0].onmousedown=null),G.html(""),W=-1,U=0},pt=function(t){J.removeClass("pivot_clrsearch"),Z=null,O||R.css("visibility",""),dt(),g.removeFilter(ct),t!==!0&&(g.filter(),lt())},vt=function(e){g.clearFilters();for(var a in Y)t.Helpers.hasOwnProperty(Y,a)&&Y[a].css("visibility","");Z&&pt(!0),R.css("visibility",""),M={},O=0,e!==!0&&(g.filter(),lt())};g.addListener("filterrequest",function(t,e){});var ft=function(){var t=!!Z;Z=N.val(),t||g.addFilter(ct),R.css("visibility","visible"),dt(),g.filter(),lt()},ht=function(t,e,a){for(var i=Math.min(a.length,e),r=function(e){var i=a[e],r=i.toLowerCase().indexOf(t.toLowerCase()),n=r+t.length,o=i.substring(0,r),s=i.substring(r,n),l=i.substring(n,i.length);$("<li>").appendTo(G).append(o).append($("<strong>").text(s)).append(l).mousedown(function(){N.val(i),ft()})},n=0;i>n;n++)r(n);return i},gt=function(t){var e=$(G.children()[W]);e.removeClass("pivot_highlight"),W=t,W>=U?W=-1:-1>W&&(W=U-1),-1===W?N.val(j):(e=$(G.children()[W]),e.addClass("pivot_highlight"),N.val(e.text()))},mt=function(t){var e=t?t.keyCode:-1;switch(e){case 38:gt(W-1);break;case 40:gt(W+1);break;case 13:n.focus();break;default:j=N.val();var a=g.runSearch(j);G.html(""),W=-1,U=ht(j,15,a)}},bt=function(){return JSON.stringify({})},yt=function(t){};return g.addListener("facetsSet",function(e,r){A=[],I.html("");for(var n in r)t.Helpers.hasOwnProperty(r,n)&&(r[n].isFilterVisible&&$("<option>").text(n).val(n).appendTo(I),r[n].isWordWheelVisible&&A.push(n));g.sortBy(I.val()),M={},O=0,W=-1,U=0,Z=null,j=null,V=null,E="",q=null,f.html(""),Y={},R=$("<div>").text("Clear All").addClass("pivot_clrlabel pivot_clr").appendTo(f).click(function(){return vt()}),$("<div>").html("&times;").addClass("pivot_clrbtn pivot_clr").appendTo(R),X=$("<form>").addClass("pivot pivot_searchform").appendTo(f).submit(function(t){ft(),t.preventDefault()}),N=$("<input>").attr("type","text").addClass("pivot_searchbox").appendTo(X),N.focus(function(){return i()}),N.blur(function(){return dt()}),N.keyup(function(t){return mt(t)}),J=$("<span>").html("&times;").addClass("pivot_searchbtn").appendTo(X),G=$("<ul>").addClass("pivot pivot_results").appendTo(X),dt();var o=[];for(var s in r)t.Helpers.hasOwnProperty(r,s)&&r[s].isFilterVisible&&o.push(s);o.sort(function(t,e){return(r[t].index||0)-(r[e].index||0)}),z=-10-X.outerHeight()-R.outerHeight();for(var l=function(e){var a=o[e],i=r[a],n=$("<div>").attr("name",a).data("facetType",i.type).addClass("pivot pivot_facetname").appendTo(f).click(function(t){return st(t)});if(i.type===t.FacetTypes.String||i.type===t.FacetTypes.LongString||i.type===t.FacetTypes.Link){var s=[];n.data("comparatorNames",s);var l=[];n.data("comparators",l),n.data("currentComparator",0),i.orders&&i.orders.length&&i.comparator&&(!function(){var t=i.comparator;l.push(function(e,a){return t(e.value,a.value)})}(),s.push("Sort: "+i.orders[0].name)),s.push("Sort: Quantity"),l.push(rt),s.push("Sort: A to Z"),l.push(nt)}var u=$("<div>").html("&times;").addClass("pivot_clrbtn pivot_clr").appendTo(n).click(function(t){return ut(t)});Y[a]=u,$("<div>").text(a).addClass("pivot_facetlabel").appendTo(n),z-=n.outerHeight(),$("<div>").height(0).css("overflow","hidden").addClass("pivot pivot_facetvalues").appendTo(f)},u=0;u<o.length;++u)l(u);if(a){var c=location.hash;if(c&&c.length>2)try{yt(decodeURIComponent(c.substr(1)))}catch(e){t.Logger.logWarning("bad URL hash")}}}),r.click("click",function(t){var e=t.target;e!==N[0]&&e!==I[0]&&n.focus()}),a&&g.addListener("finishedRearrange",function(t){location.hash="#"+encodeURIComponent(bt())}),g},e}();t.PivotViewerFactory=e}(Pivot||(Pivot={}));var Pivot;!function(t){var e=function(){function t(){}return t}();t.TileSource=e}(Pivot||(Pivot={}));var Pivot;!function(t){var e=function(){function t(t){this.id=t,this.facets={}}return t}();t.Item=e;var a=function(){function t(){}return t.String="String",t.LongString="LongString",t.Link="Link",t.Number="Number",t.DateTime="DateTime",t}();t.FacetTypes=a;var i=function(){function t(t){this.name=t,this.orders=[]}return t}();t.Facet=i}(Pivot||(Pivot={}));